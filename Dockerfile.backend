# Usar imagen base de Node.js
FROM node:20

# Directorio de trabajo
WORKDIR /app

# Copiar archivos de backend
COPY . .

# Instalar dependencias de tu app
RUN npm install

# Instalar Cloudflared en el contenedor
RUN curl -L --output cloudflared.deb https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb && \
    dpkg -i cloudflared.deb || apt-get update && apt-get install -f -y && \
    rm cloudflared.deb

# Crear directorio para cloudflared y copiar configuraci√≥n
RUN mkdir -p /root/.cloudflared
COPY cloudflared-config.yml /root/.cloudflared/config.yml

# Hacer ejecutable el script de inicio
RUN chmod +x start-backend.sh

# Exponer puerto
EXPOSE 8080

# Variables de entorno
ENV NODE_ENV=production

# Usar script de inicio
CMD ["./start-backend.sh"] 